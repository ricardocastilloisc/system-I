<div class="card-busqueda">
  <div class="mt-4">Buscar usuario por</div>
  <div
    style="
      text-align: right;
      width: 100%;
      justify-content: flex-end;
      direction: rtl;
    "
  >
    <div style="margin-right: 10%">
      <a *ngIf="filtroActivo" (click)="limpirarFiltro()" class="limpiarFiltro"
        >Eliminar Filtro
        <img src="assets/icons/Eliminar.svg" class="tamanioFiltroIcono"
      /></a>
    </div>
  </div>

  <div>
    <section class="mt-3">
      <div class="col2-row2">
        <ng-multiselect-dropdown
          style="width: 100%"
          id="correo"
          [placeholder]="'Correo electrónico'"
          [settings]="SettingsFiltroDeCorreos"
          [data]="dropdownListFiltroCorreos"
          [(ngModel)]="selectedItemsFiltroCorreos"
          (onSelect)="cambiarEtiquetaSeleccionada()"
        >
        </ng-multiselect-dropdown>
      </div>
      <div class="col2-row2">
        <ng-multiselect-dropdown
          style="width: 100%; padding-left: 10px"
          [placeholder]="'Permiso'"
          id="filtroPermiso"
          [settings]="SettingsFiltroDePermisos"
          [data]="dropdownListFiltroPermisos"
          [(ngModel)]="selectedItemsFiltroaPermisos"
          (onSelect)="cambiarEtiquetaSeleccionadaGeneral('filtroPermiso')"
        >
        </ng-multiselect-dropdown>
      </div>
      <div class="col2-row2">
        <ng-multiselect-dropdown
          style="width: 100%"
          [placeholder]="'Permiso'"
          [settings]="SettingsFiltroDeArea"
          [data]="dropdownListFiltroAreas"
          [(ngModel)]="selectedItemsFiltroAreas"
          id="filtroArea"
          (onSelect)="cambiarEtiquetaSeleccionadaGeneral('filtroArea')"
        >
        </ng-multiselect-dropdown>
      </div>
      <div class="col2-row2">
        <button style="cursor:pointer" (click)="filtrar()">Buscar</button>
      </div>
    </section>
  </div>
</div>
<div class="row justify-content-center">
  <div
    class="d-flex col-md-12 col-sm-12 col-xs-12 col-lg-12 col-xl-12 justify-content-center"
  >
    <div class="card-lista-design-general" style="overflow-x: auto">
      <ngx-spinner
        bdColor="rgba(0, 0, 0, 0.8)"
        size="large"
        color="#fff"
        type="ball-climbing-dot"
        [fullScreen]="true"
        ><p style="color: white">Cargando...</p></ngx-spinner
      >

      <table
        class="table listado-design-general"
        *ngIf="ListadoUsuariosPantalla as ListadoUsuarios"
      >
        <tr>
          <th style="padding-left: 40px; max-width: 300px">Nombre</th>
          <th style="padding-left: 40px; max-width: 300px">Correo</th>
          <th style="padding-left: 40px; max-width: 150px">Área</th>
          <th style="padding-left: 40px; max-width: 150px">Permisos</th>
          <th style="padding-left: 40px; max-width: 150px">Negocio</th>
          <th style="padding-left: 40px; max-width: 150px">Acciones</th>
        </tr>
        <tr
          *ngFor="
            let usuario of ListadoUsuariosPantalla
              | oredenascEmailusurios: 'email'
              | paginate
                : {
                    id: 'Usuarios',
                    itemsPerPage: 10,
                    currentPage: paginaActualUsuarios
                  };
            index as i
          "
        >
          <td style="padding-left: 40px; max-width: 300px">
            {{ retornarStringSiexiste(usuario.Attributes, "given_name") }}
            {{ retornarStringSiexiste(usuario.Attributes, "family_name") }}
          </td>
          <td style="padding-left: 40px; max-width: 300px">
            {{ retornarStringSiexiste(usuario.Attributes, "email") }}
          </td>
          <td style="padding-left: 40px; max-width: 150px" *ngIf="usuario.GrupoQuePertenece == 'InversionesyRiesgos'">
            Inversiones y Riesgos
          </td>
          <td style="padding-left: 40px; max-width: 150px" *ngIf="usuario.GrupoQuePertenece != 'InversionesyRiesgos'">
            {{ usuario.GrupoQuePertenece }}
          </td>
          <td style="padding-left: 40px; max-width: 150px">
            {{ retornarStringSiexiste(usuario.Attributes, "custom:rol") }}
          </td>
          <td style="padding-left: 40px; max-width: 150px">
            <p>
              {{
                retornarStringSiexiste(usuario.Attributes, "custom:negocio")
                  | quitarcoma
              }}
            </p>
          </td>
          <td style="padding-left: 40px; max-width: 150px">
            <img
            style="cursor:pointer"
              (click)="openModal(content, usuario, usuario.GrupoQuePertenece)"
              class="editar-icon"
            />
          </td>
        </tr>
      </table>
    </div>
  </div>

  <pagination-template
    id="Usuarios"
    #p="paginationApi"
    *ngIf="verPaginado()"
    (pageChange)="paginaActualUsuarios = $event"
    class="ngx-pagination"
  >
    <div class="custom-pagination">
      <div class="pagination-previous" [class.disabled]="p.isFirstPage()">
        <span *ngIf="!p.isFirstPage()" (click)="p.previous()"><< </span>
      </div>
      <div
        class="page-number"
        *ngFor="let page of p.pages"
        [class.current]="p.getCurrent() === page.value"
      >
        <span
          (click)="p.setCurrent(page.value)"
          *ngIf="p.getCurrent() !== page.value"
          >{{ page.label }}</span
        >
        <div *ngIf="p.getCurrent() === page.value">
          <span>{{ page.label }}</span>
        </div>
      </div>
      <div class="pagination-next" [class.disabled]="p.isLastPage()">
        <span *ngIf="!p.isLastPage()" (click)="p.next()"> >> </span>
      </div>
    </div>
  </pagination-template>

  <ng-template #content let-modal>
    <div class="modal-header">
      <h4 class="modal-title" id="modal-basic-title">
        <div>Cambiar permiso</div>
      </h4>
      <button type="button" aria-label="Close" (click)="modal.dismiss()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label for="dateOfBirth">Área</label>
        <div class="input-group">
          <select class="form-control" [(ngModel)]="SelectCamabiarArea">
            <option disabled selected value="Area">Área</option>
            <option *ngFor="let Area of Areas" [value]="Area">
              {{ Area }}
            </option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label for="dateOfBirth">Permiso</label>
        <div class="input-group">
          <select class="form-control" [(ngModel)]="SelectCamabiarPermiso">
            <option disabled selected value="Permiso">Permiso</option>
            <option *ngFor="let grupo of Roles" [value]="grupo.value">
              {{ grupo.label }}
            </option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label for="dateOfBirth">Negocio</label>
        <div class="input-group">
          <ng-multiselect-dropdown
            style="width: 100%"
            [placeholder]="'Negocio'"
            [settings]="SettingsCambioDeNegocio"
            [data]="dropdownListCambioDeNegocio"
            [(ngModel)]="selectedItemsCambioDeNegocio"
            id="cambiarnegocio"
            (onSelect)="cambiarEtiquetaSeleccionadaGeneral('cambiarnegocio')"
          >
          </ng-multiselect-dropdown>

          <!--
            <select formControlName="negocioCambiar" class="form-control" name="negocio" id="negocio" value="negocio">
              <option disabled selected value="negocio">Negocio</option>
              <option *ngFor="let negocio of Negocios" [value]="negocio">{{negocio}}</option>
            </select>
            -->
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button
        type="button"
        class="btn btn-primary"
        style="background-color:  #00C4D9;"
        (click)="guardarCambioPermisoUsuario()"
      >
        Guardar cambio
      </button>
      <button
        type="button"
        class="btn btn-secondary"
        data-dismiss="modal"
        (click)="modal.close()"
      >
        Cerrar
      </button>
    </div>

    <!--
          <div class="modal-footer">
      <button type="button" class="btn btn-outline-dark" (click)="modal.close()">Save</button>
    </div>
    -->
  </ng-template>
</div>
