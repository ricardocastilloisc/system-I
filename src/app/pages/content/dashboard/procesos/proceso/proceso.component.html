<div class="container-fluid" *ngIf="DataUser$ | async as DataUser">
    <div   class="flex-row-reverse justify-content-center"   style="height: 50vh; width: 100%" *ngIf="AUDGENESTADOPROCESOS$ | async as AUDGENESTADOPROCESOS">
        <div class="row justify-content-center">
        
        
            <div class="titulo-proceso">{{rutaActiva.snapshot.params.id}}</div>
    
        </div>

        <!-- <div class="row justify-content-center container-referencias-log"  >
            <div class=" d-flex col-md-2 col-xs-3 col-sm-3 col-lg-3 mr-3 col-3 align-items-center justify-content-center" style="height: 45px;">
                <a >Ver logs</a>
                

            
            </div>
            <div class=" d-flex col-md-3 col-xs-3 col-sm-3 col-lg-3 mr-3 col-3 align-items-center justify-content-center" style="height: 45px;">
                <a >Ver logs</a>
            </div>
            <div class=" d-flex col-md-3 col-xs-3 col-sm-3 col-lg-3 mr-3 col-3 align-items-center justify-content-center" style="height: 45px;">
                <a >Ver logs</a>
            </div>

        </div> -->


        <!-- <div [ngClass]="{'show-ejecuciones': mostrarEjecucionesProcesos == true, 'hide-ejecuciones': mostrarEjecucionesProcesos == false}" class="row justify-content-center hide-div ">
            <div class="d-flex col-md-9 col-xs-9 col-sm-9 col-lg-9 mr-9 col-9 align-items-center justify-content-center" >
                <div class="show-info">
                </div>
                <span *ngIf="mostrarEjecucionesProcesos" class="show-info-button" (click)="mostrarEjecucionesProcesos = !mostrarEjecucionesProcesos">Ocultar Ejecuciones</span>
            </div>
            
        </div> -->

        <div class="row justify-content-center container-referencias-log" *ngIf="!ocultarbusqueda">
            <form [formGroup]="filtroEjecucionesForm">
                <div class="d-flex col-md-12 col-sm-12 col-xs-12 col-lg-12 col-xl-12 justify-content-center">

                    
                    <div class="card-calendario">

                        
                        
                        <div>
                        <div style="
                        text-align: center;
                        width: 100%;
                        justify-content: flex-end;
                        
                        ">
                        Selecciona una fecha
                        </div>
                        

                        </div>
                        <div>
                            <input type="date" placeholder="dd-MM-yyyy" onfocus="(this.type='date')" formControlName="fechaFiltrar" id="fechaFiltrar" name="fechaFiltrar" [value]="maxDate" max="{{ maxDate| date:'yyyy-MM-dd'}}"/>
                        </div>
                        <div>
                            <input type="text" placeholder="ID de ejecución" formControlName="idProceso" id="idProceso" name="">
                        </div>
                        <!-- <div>
                            
                            <select name="estados" id="estados" value="Estado">
                                <option disabled selected>Estado</option>
                                <option value="iniciado">En proceso</option>
                                <option value="detenido">Detenido</option>
                
                            </select>
                        
                        </div> -->
                        
                        <div><button class="clickable" (click)="busquedaFiltros()" >Buscar</button> </div>
                        <div
                            style="
                            text-align: right;
                            width: 100%;
                            justify-content: flex-end;
                            direction: rtl;
                            pad
                            "
                        >
                            <div style="margin-right: 10%; " >
                            <a (click)="recargarEjecuciones()" class="limpiarFiltro clickable"
                                >Eliminar Filtro
                                <img src="assets/icons/Eliminar.svg" class="tamanioFiltroIcono"
                            /></a>
                            </div>
                        </div>
                    </div>
                    

        
                </div>
            </form>
        </div>

        <div class="row justify-content-center container-referencias-log" [ngClass]="{'show-ejecuciones': mostrarEjecucionesProcesos == true, 'hide-ejecuciones': mostrarEjecucionesProcesos == false}" *ngIf=" AUDGENESTADOPROCESOS.length !== 0"  >

            
            
        
            <div class="d-flex col-md-9 col-xs-9 col-sm-9 col-lg-9 mr-9 col-9 align-items-left justify-content-left ">
                <span class="title-log-table">Listado de ejecuciones</span>
            </div>
            <div class="d-flex col-md-9 col-xs-9 col-sm-9 col-lg-9 mr-9 col-9 align-items-center justify-content-center" >
                <table class="listado-log listado-ejecuciones" >
                    
                    <thead>
                        <tr>
                            <th>ID Ejecucion</th>
                            <th>Hora</th>
                            <th colspan="12" >Resultado ejecución</th>
                        </tr>
                    </thead>
                    <tbody>
                        
                        
                            <tr *ngFor="let AUDGENESTADOPROCESO of AUDGENESTADOPROCESOS | paginate: {id: 'ejecucionesProceso', itemsPerPage: 10, currentPage: paginaActualEjecucionesProceso} ; index as i" class='clickable' (click)="consultarDetalle(AUDGENESTADOPROCESO.ID_PROCESO, AUDGENESTADOPROCESO.FECHA_CREADO )" >
                                
                                <td >{{AUDGENESTADOPROCESO.ID_PROCESO}}</td>
                                <td >{{AUDGENESTADOPROCESO.FECHA_ACTUALIZACION | date :'dd/MM/yyyy'}} {{AUDGENESTADOPROCESO.FECHA_ACTUALIZACION | date:'mediumTime'}}  </td>
                                <td [ngClass]="{'error-log': AUDGENESTADOPROCESO.ESTADO == 'FALLIDO'}">{{AUDGENESTADOPROCESO.ESTADO}}</td>

                            </tr>
                        
                    </tbody>
                    
                </table>

            </div>
            <div class="d-flex col-md-9 col-xs-9 col-sm-9 col-lg-9 mr-9 col-9 align-items-left " >
                <pagination-template id="ejecucionesProceso" #p="paginationApi" (pageChange)="paginaActualEjecucionesProceso = $event" class="ngx-pagination" *ngIf="AUDGENESTADOPROCESOS.length > 10">

                    <div class="custom-pagination">
                        <div class="pagination-previous" [class.disabled]="p.isFirstPage()">
                        <span *ngIf="!p.isFirstPage()" (click)="p.previous()"><<</span> 
                        </div> 
                        <div class="page-number" *ngFor="let page of p.pages" [class.current]="p.getCurrent() === page.value">
                                <span (click)="p.setCurrent(page.value)" *ngIf="p.getCurrent() !== page.value">{{ page.label }}</span>
                            <div *ngIf="p.getCurrent() === page.value">
                                <span>{{ page.label }}</span>
                            </div>
                        </div>
                        <div class="pagination-next" [class.disabled]="p.isLastPage()">
                            <span *ngIf="!p.isLastPage()" (click)="p.next()"> >> </span>
                            
                        </div>
                    </div>

                </pagination-template>
            </div>

        
        </div>

        <div class="row justify-content-center container-referencias-log" *ngIf=" AUDGENESTADOPROCESOS.length === 0"  >

           

          <div>
              No existen registros de ejecución para este proceso.
          </div>

        </div>
    
        <div [ngClass]="{'show-ejecuciones': mostrarEjecucionesProcesos == false, 'hide-ejecuciones': mostrarEjecucionesProcesos == true}" (click)="recargarEjecuciones()" class="row justify-content-center .hide-div ">
            <div class="d-flex col-md-9 col-xs-9 col-sm-9 col-lg-9 mr-9 col-9 align-items-center justify-content-center" >
                <div class="show-info"> </div>
                <span *ngIf="mostrarEjecucionesProcesos" class="show-info-button" (click)="mostrarEjecucionesProcesos = !mostrarEjecucionesProcesos">Ocultar Ejecuciones</span>
                <span *ngIf="!mostrarEjecucionesProcesos" class="show-info-button" (click)="mostrarEjecucionesProcesos = !mostrarEjecucionesProcesos">Mostrar Ejecuciones</span>
            </div>
            
        </div>

    



        <div *ngIf="AUDGENEJECUCIONPROCESO$ | async as AUDGENEJECUCIONPROCESO  " class="d-flex col-md-9 col-xs-9 col-sm-9 col-lg-9 mr-9 col-9 align-items-center justify-content-center container-progeso show-ejecuciones" style="height: 45px;" #detalleProceso [ngClass]="{'show-ejecuciones': mostrarEjecucionesProcesos == false, 'hide-ejecuciones': mostrarEjecucionesProcesos == true}">
            
            <div [ngClass]="{'step-completado': AUDGENEJECUCIONPROCESO[0]?.ETAPA != 'INICIAL', 'step-incompleto': AUDGENEJECUCIONPROCESO[0]?.ESTADO == 'FALLIDO' && AUDGENEJECUCIONPROCESO[0]?.ETAPA == 'INICIAL'}"  class="step-proceso step-proceso-enabled" style="margin-left: -0px;">
                <span >
                    <div>INICIAL</div>
                    <div class="separador-titulos"></div>
                    <div *ngIf="AUDGENEJECUCIONPROCESO[0]?.ETAPA !== 'INICIAL' ">Completado</div>
                    <div *ngIf="(AUDGENEJECUCIONPROCESO[0]?.ETAPA === 'INICIAL' && AUDGENEJECUCIONPROCESO[0]?.ESTADO_EJECUCION === 'INICIADO') ">En Proceso</div>
                    <div *ngIf="(AUDGENEJECUCIONPROCESO[0]?.ETAPA === 'INICIAL' && AUDGENEJECUCIONPROCESO[0]?.ESTADO === 'FALLIDO') ">Error</div>
                </span>
            </div>

            

            <div  [ngClass]="{'step-proceso-disabled': AUDGENEJECUCIONPROCESO[0]?.ETAPA == 'INICIAL',
                            'step-proceso-enabled': AUDGENEJECUCIONPROCESO[0]?.ETAPA == 'PROCESAMIENTO' || AUDGENEJECUCIONPROCESO[0]?.ETAPA == 'FINAL',
                            'step-completado': AUDGENEJECUCIONPROCESO[0]?.ETAPA == 'FINAL' || (AUDGENEJECUCIONPROCESO[0]?.ESTADO_EJECUCION == 'FINALIZADO' &&  AUDGENEJECUCIONPROCESO[0]?.ETAPA == 'PROCESAMIENTO') , 
                            'step-incompleto': AUDGENEJECUCIONPROCESO[0]?.ESTADO == 'FALLIDO' && AUDGENEJECUCIONPROCESO[0]?.ETAPA == 'PROCESAMIENTO'
                            }" class=" step-1-proceso">
                <span >
                    <div>PROCESAMIENTO</div>
                    <div *ngIf="AUDGENEJECUCIONPROCESO[0]?.ETAPA !== 'INICIAL'">
                        <div  class="separador-titulos"></div>
                        <div *ngIf="(AUDGENEJECUCIONPROCESO[0]?.ETAPA === 'FINAL' && AUDGENEJECUCIONPROCESO[0]?.ESTADO === 'EXITOSO') || (AUDGENEJECUCIONPROCESO[0]?.ETAPA === 'PROCESAMIENTO' && AUDGENEJECUCIONPROCESO[0]?.ESTADO === 'EXITOSO')">Completado</div>
                        <div *ngIf="(AUDGENEJECUCIONPROCESO[0]?.ETAPA === 'PROCESAMIENTO' && AUDGENEJECUCIONPROCESO[0]?.ESTADO_EJECUCION === 'INICIADO') ">En Proceso</div>
                        <div *ngIf="(AUDGENEJECUCIONPROCESO[0]?.ETAPA === 'PROCESAMIENTO' && AUDGENEJECUCIONPROCESO[0]?.ESTADO === 'FALLIDO') ">Error</div>
                    </div>
                </span>
            </div>

            

            <div  [ngClass]="{'step-proceso-disabled': AUDGENEJECUCIONPROCESO[0]?.ETAPA != 'FINAL',
                            'step-proceso-enabled': AUDGENEJECUCIONPROCESO[0]?.ETAPA === 'FINAL',
                            'step-completado-final': AUDGENEJECUCIONPROCESO[0]?.ESTADO == 'EXITOSO' && AUDGENEJECUCIONPROCESO[0]?.ETAPA == 'FINAL', 
                            'step-incompleto': AUDGENEJECUCIONPROCESO[0]?.ESTADO == 'FALLIDO' && AUDGENEJECUCIONPROCESO[0]?.ETAPA == 'FINAL'
                            }" class="step-4-proceso">
                <span >
                    <div>FINAL</div>
                    <div *ngIf="AUDGENEJECUCIONPROCESO[0]?.ETAPA === 'FINAL'">
                        <div  class="separador-titulos"></div>
                        <div *ngIf="AUDGENEJECUCIONPROCESO[0]?.ESTADO === 'EXITOSO' && AUDGENEJECUCIONPROCESO[0]?.ETAPA === 'FINAL'">Completado</div>
                        <div *ngIf="(AUDGENEJECUCIONPROCESO[0]?.ETAPA === 'FINAL' && AUDGENEJECUCIONPROCESO[0]?.ESTADO_EJECUCION === 'INICIADO') ">En Proceso</div>
                        <div *ngIf="(AUDGENEJECUCIONPROCESO[0]?.ETAPA === 'FINAL' && AUDGENEJECUCIONPROCESO[0]?.ESTADO === 'FALLIDO') ">Error</div>
                    </div>
                </span>
            </div>
        
        </div>

        
        <div class="row justify-content-center container-referencias-log"  *ngIf="AUDGENPROCESOS$ | async as AUDGENPROCESOS" [ngClass]="{'show-ejecuciones': mostrarEjecucionesProcesos == false, 'hide-ejecuciones': mostrarEjecucionesProcesos == true}">
            <div class="d-flex col-md-9 col-xs-9 col-sm-9 col-lg-9 mr-9 col-9 align-items-left justify-content-left ">
                <span class="title-log-table">Monitoreo de actividades  </span>
            </div>
            <div class="d-flex col-md-9 col-xs-9 col-sm-9 col-lg-9 mr-9 col-9 align-items-center justify-content-center" *ngIf="area == 'SOPORTE'">
                <table class="listado-log" >
                    
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Tipo</th>
                            <th>Hora</th>
                            <th colspan="12" >Mensaje</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let AUDGENPROCESO of AUDGENPROCESOS | paginate: { id: 'detalleEjecucion', itemsPerPage: 10, currentPage: paginaActualProceso} ; index as i ">
                            <td>{{i + 1}}</td>
                            <td [ngClass]="{'error-log': AUDGENPROCESO.NIVEL === 'FALLIDO', 'info-log': AUDGENPROCESO.NIVEL === 'INFO' , 'debug-log': AUDGENPROCESO.NIVEL === 'DEBUG' }">{{AUDGENPROCESO.NIVEL}}</td>
                            <td >{{AUDGENPROCESO.FECHA | date :'dd/MM/yyyy'}} {{AUDGENPROCESO.FECHA | date:'mediumTime'}} </td>
                            <td [ngClass]="{'error-log': AUDGENPROCESO.NIVEL === 'FALLIDO'}">{{AUDGENPROCESO.MENSAJE_SOPORTE}}</td>
                        </tr>
                    </tbody>
                </table>

            </div> 
            
                

                <div class="d-flex col-md-9 col-xs-9 col-sm-9 col-lg-9 mr-9 col-9 align-items-center justify-content-center" *ngIf="usuario.validarRolUsuario() && rolesValids(DataUser, [Administrador]) && area != 'SOPORTE' ">
                    <table class="listado-log" >
                        
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Hora</th>
                                <th colspan="12" >Mensaje</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let AUDGENPROCESO of AUDGENPROCESOS | paginate: { id: 'detalleEjecucion', itemsPerPage: 10, currentPage: paginaActualProceso} ; index as i">
                                <td>{{i + 1 }}</td>
                                <td >{{AUDGENPROCESO.FECHA | date :'dd/MM/yyyy'}} {{AUDGENPROCESO.FECHA | date:'mediumTime'}} </td>
                                <td [ngClass]="{'error-log': AUDGENPROCESO.NIVEL === 'FALLIDO'} ">{{AUDGENPROCESO.MENSAJE_NEGOCIO}}</td>
                                
                                <!-- <td  [ngClass]="{'error-log': AUDGENPROCESO.NIVEL === 'FALLIDO'}" *ngIf="area == 'SOPORTE' ">{{AUDGENPROCESO.MENSAJE_SOPORTE}}</td> -->
                            </tr>
                        </tbody>
                    </table>
                </div> 
                <div class="d-flex col-md-9 col-xs-9 col-sm-9 col-lg-9 mr-9 col-9 align-items-left " >
                <pagination-template id="detalleEjecucion" #p="paginationApi" (pageChange)="paginaActualProceso = $event" class="ngx-pagination" *ngIf="AUDGENPROCESOS.length > 10" >

                    <div class="custom-pagination">
                        <div class="pagination-previous" [class.disabled]="p.isFirstPage()">
                            <span *ngIf="!p.isFirstPage()" (click)="p.previous()"><<</span> 
                        </div> 
                        <div class="page-number" *ngFor="let page of p.pages" [class.current]="p.getCurrent() === page.value">
                                <span (click)="p.setCurrent(page.value)" *ngIf="p.getCurrent() !== page.value">{{ page.label }}</span>
                            <div *ngIf="p.getCurrent() === page.value">
                                <span>{{ page.label }}</span>
                            </div>
                        </div>
                        <div class="pagination-next" [class.disabled]="p.isLastPage()">
                            <span *ngIf="!p.isLastPage()"  (click)="p.next()"> >> </span>
                            
                        </div>
                    </div>

                </pagination-template>
            </div>
  



        </div>
    </div>

    <ng-template #modalEstado let-modal id="modalFiltro">
        <div class="modal-body">
          <div class="row justify-content-center">
            <div class="col-12 row justify-content-center align-items-center" style="height:120px;">
              <div class="textoConfirmacionModalUsuarios">Busqueda por filtro</div>
            </div>
            <div class="col-12 row">
              <div class="col-12 descripcionConfirmacionEjecucionProceso">Ingresa un valor para realizar la busqueda</div>
              
            </div>
            <div class="col-12 row justify-content-center align-items-center" style="height:120px;">
              <div>
                <button class="btn bottonConfirmarEjecucionProceso" (click)="cerrarModales()">Aceptar</button>
              </div>
            </div>
          </div>
        </div>
    
        <!--
              <div class="modal-footer">
          <button type="button" class="btn btn-outline-dark" (click)="modal.close()">Save</button>
        </div>
        -->
      </ng-template>
</div>